<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xml:lang="ja" lang="ja">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
</head>
<body>
<ui:composition template="../layout.xhtml">

	<ui:define name="title">部署管理</ui:define>
	<ui:define name="headline">部署一覧</ui:define>

	<ui:define name="js">
	$(function() {
		$('#inputForm').css('display', 'none');
		$('.editButton').removeAttr('disabled');

		$("#f\\:saveButton").live("click", function(event) {
			jsf.ajax.request(event.target , event, {
				execute:"@form", render:"f:sectionTable f:errors", onevent:onStatusChange
			});
			event.preventDefault();
		});

		$("#f\\:deleteButton").live("click", function(event) {
			if (confirm('本当に削除しますか？')) {
				jsf.ajax.request(event.target , event, {
					execute:"@form", render:"f:sectionTable f:errors", onevent:onStatusChange
				});
			}
			event.preventDefault();
		});

		$('#close').live("click", function(event) {
			$('#inputForm').css('display', 'none');
			$('.editButton').removeAttr('disabled');
			$('#f\\:errors').text('');
			return false;
		});
	});

	var edit = false;

	function showAddForm() {
		edit = false;
		$('#f\\:id').val(0);
		$('#f\\:sectionName').val('');
		$('#inputForm').css('display', 'block');
		$('#inputForm input:first').focus();
		$('#f\\:deleteButton').css('display', 'none');
		$('.editButton').attr('disabled', true);
	}

	function showEditForm(id) {
		edit = true;
		$('#f\\:id').val(id);
		$('#f\\:sectionName').val($('#sectionName'+id).text());
		$('#inputForm').css('display', 'block');
		$('#inputForm input:first').focus();
		$('#f\\:deleteButton').css('display', 'inline');
		$('.editButton').attr('disabled', true);
	}

	function onStatusChange(data) {
		if (data.type == 'event') {
			if (data.status == 'begin') {
				$('.formButton').attr('disabled', true);
			}
			if (data.status == 'success') {
				if ($('#f\\:errors').html() == '') {
					$('#inputForm').css('display', 'none');
					$('.editButton').removeAttr('disabled');
				} else {
					$('#f\\:errors').css('color', '#f00');
					$('.editButton').attr('disabled', true);
				}
			}
			if (data.status == 'complete') {
				$('.formButton').removeAttr('disabled');
			}
		}
	}
	</ui:define>

	<ui:define name="contents">
	<form jsfc="h:form" id="f" >
		<p><input type="button" class="editButton" value="新規登録" onclick="showAddForm()" /></p>
		<div id="inputForm" style="height:auto; margin:-6em 0 0 -12em; width:auto;">
			<div>
				<label for="sectionName">部署名 <h:message for="sectionName" id="errors"/></label>
				<h:inputText type="text" id="sectionName" value="#{sectionAction.section.sectionName}" size="32" maxlength="32" required="true">
					<f:validateLength maximum="25"/>
				</h:inputText>
				<input jsfc="h:inputHidden" type="hidden" id="id" value="#{sectionAction.section.id}" />
			</div>
			<div style="text-align:right;">
				<input jsfc="h:commandButton" type="submit" id="saveButton" class="formButton" actionListener="#{sectionAction.save}" value="保存" style="float:left;" />
				<input jsfc="h:commandButton" type="submit" id="deleteButton" class="formButton" actionListener="#{sectionAction.delete}" value="削除" />
				<input type="submit" id="close" class="formButton" value="閉じる" />
			</div>
		</div>
		<h:dataTable id="sectionTable" value="#{sectionAction.sectionList}" var="row">
			<h:column>
				<f:facet name="header"><h:outputText value="ID"/></f:facet>
				<span id="id#{row.id}">#{row.id}</span>
			</h:column>
			<h:column>
				<f:facet name="header"><h:outputText value="部署名"/></f:facet>
				<span id="sectionName#{row.id}">#{row.sectionName}</span>
			</h:column>
			<h:column>
				<f:facet name="header"><h:outputText value="操作"/></f:facet>
				<input type="button" class="editButton" value="編集" onclick="showEditForm(#{row.id})" />
			</h:column>
		</h:dataTable>
	</form>
	</ui:define>

</ui:composition>
</body>
</html>